<div class="flex flex-col gap-4 h-full overflow-hidden p-1">
   <!-- Tabs Navigation -->
   <div
      class="shrink-0 flex items-center gap-1 sm:gap-2 bg-white rounded-2xl p-1.5 sm:p-2 shadow-sm border border-slate-200/60 overflow-x-auto">
      <button *ngFor="let tab of visibleTabs()" (click)="activeTab.set(tab.id)"
         class="px-3 py-2 sm:px-5 sm:py-3 rounded-xl text-xs sm:text-sm font-bold transition-all whitespace-nowrap flex-shrink-0"
         [ngClass]="activeTab() === tab.id 
        ? 'bg-brand-purple text-white shadow-lg shadow-purple-500/20' 
        : 'text-slate-500 hover:bg-slate-50'">
         <span class="flex items-center gap-1.5 sm:gap-2">
            <span [innerHTML]="tab.icon"></span>
            <span class="hidden xs:inline">{{ tab.label }}</span>
            <span class="xs:hidden">{{ tab.label.split(' ')[0] }}</span>
         </span>
      </button>
   </div>

   <!-- Tab Content -->
   <div class="flex-1 min-h-0 overflow-hidden flex flex-col">
      <!-- Tab 1: Entrada Mensual -->
      <ng-container *ngIf="activeTab() === 'entrada'">
         <div class="flex flex-col gap-4 flex-1 min-h-0">
            <!-- Summary Cards (Hidden on mobile for more vertical space) -->
            <app-informes-stats [resumen]="resumen()"></app-informes-stats>

            <!-- Filters Bar (Custom Dropdowns) -->
            <app-informes-filters [activeDropdown]="activeDropdown()" [isRestrictedUser]="isRestrictedUser()"
               [selectedMes]="selectedMes" [selectedAno]="selectedAno" [selectedGrupo]="selectedGrupo" [meses]="meses"
               [anos]="anos" [grupos]="grupos()" [vistaGrupo]="vistaGrupo()" [searchQuery]="searchQuery"
               [soloSinInforme]="soloSinInforme" (toggleDropdown)="toggleDropdown($event)"
               (closeDropdown)="closeDropdown()" (selectMes)="selectMes($event)" (selectAno)="selectAno($event)"
               (selectGrupo)="selectGrupo($event)" (setVista)="setVista($event)"
               (searchQueryChange)="searchQuery = $event; loadResumen()"
               (soloSinInformeChange)="onSoloSinInformeChange($event)">
            </app-informes-filters>

            <!-- Data List/Table Container -->
            <app-informes-table [resumen]="resumen()" [saving]="saving()" [privilegios]="privilegios()"
               [publicadorPrivilegiosMap]="publicadorPrivilegiosMap()" [localChanges]="localChanges"
               (informeChange)="handleInformeChange($event)" (save)="guardarTodo()" (exportExcel)="exportarExcel()"
               (importExcel)="importarExcel($event)">
            </app-informes-table>
         </div>
      </ng-container>

      <!-- Tab 2: Historial (Placeholder) -->
      <ng-container *ngIf="activeTab() === 'historial'">
         <app-informes-historial [selectedAno]="+selectedAno" [congregacionId]="authStore.user()?.id_congregacion || 0"
            [grupos]="grupos()">
         </app-informes-historial>
      </ng-container>


      <!-- Tab 3: Resumen Sucursal (Placeholder) -->
      <ng-container *ngIf="activeTab() === 'sucursal'">
         <div
            class="bg-white rounded-2xl p-8 shadow-sm border border-slate-200/60 h-full flex items-center justify-center">
            <div class="text-center">
               <div class="w-20 h-20 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <svg class="w-10 h-10 text-brand-purple" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
               </div>
               <h3 class="text-xl font-bold text-slate-900">Resumen para Sucursal</h3>
               <p class="text-slate-500 mt-2">Pr√≥ximamente disponible</p>
            </div>
         </div>
      </ng-container>
   </div>

   <!-- Toast Notification -->
   <div *ngIf="toastMessage()" class="fixed bottom-6 right-6 z-[100] animate-fadeInUp max-w-md">
      <div class="flex items-start gap-3 px-5 py-4 rounded-xl shadow-xl border backdrop-blur-sm" [ngClass]="toastMessage()?.type === 'success' 
        ? 'bg-emerald-50 border-emerald-200 text-emerald-800' 
        : toastMessage()?.type === 'error'
        ? 'bg-red-50 border-red-200 text-red-800'
        : 'bg-blue-50 border-blue-200 text-blue-800'">
         <div class="w-8 h-8 rounded-full flex items-center justify-center shrink-0 mt-0.5"
            [ngClass]="toastMessage()?.type === 'success' ? 'bg-emerald-500' : toastMessage()?.type === 'error' ? 'bg-red-500' : 'bg-blue-500'">
            <svg *ngIf="toastMessage()?.type === 'success'" class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="3">
               <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <svg *ngIf="toastMessage()?.type === 'error'" class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="3">
               <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
            <svg *ngIf="toastMessage()?.type === 'info'" class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="3">
               <path stroke-linecap="round" stroke-linejoin="round"
                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
         </div>
         <div class="flex-1">
            <p class="text-sm font-bold">{{ toastMessage()?.title }}</p>
            <p *ngIf="toastMessage()?.text" class="text-xs mt-1 opacity-80 whitespace-pre-line">{{ toastMessage()?.text
               }}</p>
         </div>
         <button (click)="toastMessage.set(null)" class="p-1 rounded-lg hover:bg-black/5 transition-colors shrink-0">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
               <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
         </button>
      </div>
   </div>
</div>