<div class="h-screen bg-[#f3f4f6] flex flex-col font-sans overflow-hidden">

   <!-- Minimalist Header -->
   <header class="bg-white/95 backdrop-blur-sm border-b border-slate-200/80 shadow-sm z-40 sticky top-0 shrink-0">
      <div class="px-4 sm:px-6 lg:px-8 py-3 sm:py-4">
         <div class="flex items-center justify-between gap-4">

            <!-- Title & Back -->
            <div class="flex items-center gap-5 min-w-0">
               <button (click)="goBack()"
                  class="w-10 h-10 rounded-xl bg-slate-50 border border-slate-100 flex items-center justify-center text-slate-400 hover:text-slate-900 hover:bg-white hover:shadow-sm transition-all active:scale-95 group">
                  <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                     <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                  </svg>
               </button>
               <div class="flex flex-col min-w-0">
                  <h1 class="text-xl font-bold text-slate-900 tracking-tight truncate">Asignar Publicadores</h1>
                  <div class="flex items-center gap-2 text-sm font-medium text-slate-500">
                     <span class="text-xs uppercase tracking-wider font-bold text-slate-400">Grupo</span>
                     <span
                        class="text-orange-600 font-bold bg-orange-50 px-2 py-0.5 rounded text-xs tracking-wide truncate max-w-[250px]">{{
                        grupo()?.nombre_grupo || '...' }}</span>
                  </div>
               </div>
            </div>

            <!-- Actions -->
            <div class="flex items-center gap-3 shrink-0">
               <button (click)="goBack()"
                  class="hidden sm:flex px-5 py-2 rounded-lg text-slate-500 font-bold text-sm hover:bg-slate-50 hover:text-slate-800 transition-colors">
                  Cancelar
               </button>
               <button (click)="save()" [disabled]="saving()"
                  class="px-6 py-2.5 rounded-xl bg-orange-500 text-white font-bold text-sm tracking-wide hover:bg-orange-600 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-all shadow-sm hover:shadow-orange-200">
                  <svg *ngIf="saving()" class="animate-spin h-4 w-4 text-white" viewBox="0 0 24 24">
                     <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                     <path class="opacity-75" fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                     </path>
                  </svg>
                  <span>{{ saving() ? 'Guardando...' : 'Guardar Cambios' }}</span>
               </button>
            </div>
         </div>
      </div>
   </header>

   <!-- Main Content -->
   <main class="flex-1 min-h-0 overflow-y-auto lg:overflow-hidden p-4 sm:p-10 lg:p-12 pb-6 lg:pb-0">
      <div
         class="w-full max-w-[1920px] mx-auto h-auto lg:h-full grid grid-cols-1 lg:grid-cols-[1fr_auto_1fr] gap-6 lg:gap-16 items-start relative pb-8">

         <!-- LISTA: Disponibles (Left Panel) -->
         <div
            class="h-[45vh] lg:h-full bg-white rounded-2xl border border-slate-200 flex flex-col overflow-hidden shadow-[0_2px_10px_rgba(0,0,0,0.02)]">

            <!-- Panel Header -->
            <div class="p-5 border-b border-slate-100 bg-white">
               <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center gap-3">
                     <div class="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-400">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                           <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                           <circle cx="9" cy="7" r="4"></circle>
                           <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                           <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                     </div>
                     <div>
                        <h2 class="text-base font-bold text-slate-800">Disponibles</h2>
                        <p class="text-[11px] font-semibold text-slate-400">Sin grupo asignado</p>
                     </div>
                  </div>
                  <div class="flex items-center gap-2">
                     <button (click)="toggleSelectAll('available')"
                        class="p-1 px-1.5 rounded-lg text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-colors"
                        title="Seleccionar todos">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                           <path stroke-linecap="round" stroke-linejoin="round"
                              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                     </button>
                     <span class="bg-slate-100 text-slate-600 text-xs font-bold px-2.5 py-1 rounded-md">{{
                        filteredAvailable().length }}</span>
                  </div>
               </div>

               <!-- Minimal Search -->
               <div class="relative">
                  <input type="text" placeholder="Buscar..."
                     class="w-full h-10 bg-slate-50 border-none text-slate-700 text-sm rounded-lg pl-9 pr-4 focus:ring-1 focus:ring-orange-500 focus:bg-white transition-all placeholder:text-slate-400 font-medium"
                     [(ngModel)]="searchAvailable">
                  <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                     <svg class="w-4 h-4 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2.5">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                     </svg>
                  </div>
               </div>
            </div>

            <!-- List Content -->
            <div class="flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar bg-white">
               <div *ngFor="let p of filteredAvailable()"
                  class="group relative flex items-center p-2.5 rounded-xl border transition-all cursor-pointer select-none mb-2"
                  [ngClass]="{
                        'bg-slate-50/50 border-slate-200 hover:bg-white hover:border-slate-300 hover:shadow-sm': !p.selected,
                        'bg-orange-50 border-orange-200 shadow-sm ring-1 ring-orange-200': p.selected
                     }" (click)="toggleSelection(p)">
                  <!-- Avatar & Info -->
                  <!-- Avatar & Info -->
                  <div class="flex items-center gap-3 min-w-0 flex-1">
                     <!-- Modern Avatar with Initials -->
                     <div
                        class="w-10 h-10 sm:w-12 sm:h-12 rounded-2xl flex items-center justify-center text-sm font-bold shrink-0 transition-transform duration-300 group-hover:scale-105"
                        [ngClass]="getAvatarClass(p.id_publicador)">
                        {{ getInitials(p) }}
                     </div>

                     <div class="min-w-0 flex-1">
                        <div class="flex items-center justify-between">
                           <p
                              class="text-[14px] font-bold text-slate-800 truncate group-hover:text-slate-900 transition-colors">
                              {{ getFullName(p) }}
                           </p>
                        </div>
                        <div class="flex items-center gap-1 mt-0.5 flex-wrap">
                           <!-- Privilegios Tags -->
                           <ng-container *ngIf="getPrivilegioTags(p).length > 0; else noPrivilegioSimple">
                              <span *ngFor="let tag of getPrivilegioTags(p)"
                                 class="inline-flex items-center text-[9px] font-bold px-1.5 py-0.5 rounded-md whitespace-nowrap shadow-sm"
                                 [ngClass]="tag.class" [title]="tag.label">
                                 {{ tag.label }}
                              </span>
                           </ng-container>
                           <ng-template #noPrivilegioSimple>
                              <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest truncate">
                                 Publicador</p>
                           </ng-template>
                        </div>
                     </div>

                     <!-- Checkbox (Minimal) -->
                     <div
                        class="w-5 h-5 rounded-full border flex items-center justify-center transition-all shrink-0 ml-1"
                        [ngClass]="{
                              'border-slate-300 bg-white group-hover:border-slate-400': !p.selected,
                              'border-orange-500 bg-orange-500 text-white': p.selected
                           }">
                        <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M20 6L9 17l-5-5" />
                        </svg>
                     </div>
                  </div>
               </div>

               <!-- Empty State -->
               <div *ngIf="filteredAvailable().length === 0"
                  class="h-full flex flex-col items-center justify-center text-center p-8 opacity-40">
                  <p class="text-sm font-bold text-slate-400">Sin resultados</p>
               </div>
            </div>
         </div>

         <!-- ACTION BUTTONS CENTER (Modern Flat) -->
         <div class="hidden lg:flex flex-col gap-3 justify-center h-full z-10 px-2 lg:px-4">
            <button (click)="moveToGroup()"
               class="w-12 h-12 rounded-xl bg-orange-50 border border-orange-100 text-orange-500 hover:bg-orange-500 hover:text-white hover:border-orange-500 hover:scale-105 transition-all duration-200 flex items-center justify-center shadow-sm"
               title="Agregar al grupo">
               <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
               </svg>
            </button>
            <button (click)="moveToAvailable()"
               class="w-12 h-12 rounded-xl bg-white border border-slate-200 text-slate-400 hover:bg-slate-50 hover:text-slate-600 hover:border-slate-300 hover:scale-105 transition-all duration-200 flex items-center justify-center shadow-sm"
               title="Quitar del grupo">
               <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M11 17l-5-5m0 0l5-5m-5 5h12" />
               </svg>
            </button>
         </div>

         <!-- ACTION BUTTONS MOBILE (Middle of flow) -->
         <div class="flex lg:hidden items-center justify-center gap-4 py-2 shrink-0">
            <!-- Move DOWN (Available -> Group) -->
            <button (click)="moveToGroup()"
               class="w-14 h-14 rounded-2xl bg-orange-50 border border-orange-200 text-orange-600 hover:bg-orange-600 hover:text-white transition-all flex items-center justify-center shadow-sm active:scale-95 active:bg-orange-600 active:text-white"
               title="Agregar al grupo">
               <svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m0 0l-6-6m6 6l6-6" />
               </svg>
            </button>

            <!-- Move UP (Group -> Available) -->
            <button (click)="moveToAvailable()"
               class="w-14 h-14 rounded-2xl bg-white border border-slate-200 text-slate-400 hover:bg-slate-50 hover:text-slate-600 transition-all flex items-center justify-center shadow-sm active:scale-95 active:bg-slate-100"
               title="Quitar del grupo">
               <svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 20V4m0 0l-6 6m6-6l6 6" />
               </svg>
            </button>
         </div>

         <!-- LISTA: Miembros del Grupo (Right Panel) -->
         <div
            class="h-[45vh] lg:h-full bg-white rounded-2xl border border-orange-200 shadow-[0_4px_20px_rgba(249,115,22,0.04)] flex flex-col overflow-hidden relative">

            <!-- Panel Header -->
            <div class="p-5 border-b border-orange-50 bg-orange-50/20">
               <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center gap-3">
                     <div class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center text-orange-500">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                           <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                           <circle cx="9" cy="7" r="4"></circle>
                           <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                           <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                     </div>
                     <div>
                        <h2 class="text-base font-bold text-slate-900">Miembros</h2>
                        <p class="text-[11px] font-semibold text-orange-500">Asignados al grupo</p>
                     </div>
                  </div>
                  <div class="flex items-center gap-2">
                     <button (click)="toggleSelectAll('members')"
                        class="p-1 px-1.5 rounded-lg text-orange-400 hover:text-orange-600 hover:bg-orange-100 transition-colors"
                        title="Seleccionar todos">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                           <path stroke-linecap="round" stroke-linejoin="round"
                              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                     </button>
                     <span class="bg-orange-100 text-orange-600 text-xs font-bold px-2.5 py-1 rounded-md">{{
                        filteredGroupMembers().length }}</span>
                  </div>
               </div>

               <!-- Minimal Search -->
               <div class="relative">
                  <input type="text" placeholder="Buscar..."
                     class="w-full h-10 bg-white border border-orange-100 text-slate-700 text-sm rounded-lg pl-9 pr-4 focus:ring-1 focus:ring-orange-500 focus:border-orange-500 transition-all placeholder:text-orange-300 font-medium"
                     [(ngModel)]="searchGroup">
                  <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                     <svg class="w-4 h-4 text-orange-300" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2.5">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                     </svg>
                  </div>
               </div>
            </div>

            <!-- List Content -->
            <div class="flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar bg-white">
               <div *ngFor="let p of filteredGroupMembers()"
                  class="group relative flex items-center p-2.5 rounded-xl border transition-all cursor-pointer select-none mb-2"
                  [ngClass]="{
                        'bg-orange-50/30 border-orange-100 hover:bg-orange-50 hover:border-orange-200 hover:shadow-sm': !p.selected,
                        'bg-orange-100 border-orange-300 shadow-sm ring-1 ring-orange-300': p.selected
                     }" (click)="toggleSelection(p)">
                  <!-- Avatar & Info -->
                  <!-- Avatar & Info -->
                  <div class="flex items-center gap-3 min-w-0 flex-1">
                     <!-- Modern Avatar with Initials -->
                     <div
                        class="w-10 h-10 sm:w-12 sm:h-12 rounded-2xl flex items-center justify-center text-sm font-bold shrink-0 transition-transform duration-300 group-hover:scale-105"
                        [ngClass]="getAvatarClass(p.id_publicador)">
                        {{ getInitials(p) }}
                     </div>

                     <div class="min-w-0 flex-1">
                        <div class="flex items-center justify-between">
                           <p
                              class="text-[14px] font-bold text-slate-800 truncate group-hover:text-orange-700 transition-colors">
                              {{ getFullName(p) }}
                           </p>

                        </div>
                        <div class="flex items-center gap-1 mt-0.5 flex-wrap">
                           <!-- Privilegios Tags -->
                           <ng-container *ngIf="getPrivilegioTags(p).length > 0; else noPrivilegioGroup">
                              <span *ngFor="let tag of getPrivilegioTags(p)"
                                 class="inline-flex items-center text-[9px] font-bold px-1.5 py-0.5 rounded-md whitespace-nowrap shadow-sm"
                                 [ngClass]="tag.class" [title]="tag.label">
                                 {{ tag.label }}
                              </span>
                           </ng-container>
                           <ng-template #noPrivilegioGroup>
                              <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest truncate">
                                 Publicador</p>
                           </ng-template>
                        </div>
                     </div>

                     <!-- Checkbox (Minimal) -->
                     <div
                        class="w-5 h-5 rounded-full border flex items-center justify-center transition-all shrink-0 ml-1"
                        [ngClass]="{
                              'border-slate-300 bg-white group-hover:border-orange-300': !p.selected,
                              'border-orange-500 bg-orange-500 text-white': p.selected
                           }">
                        <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M20 6L9 17l-5-5" />
                        </svg>
                     </div>
                  </div>
               </div>

               <!-- Empty State -->
               <div *ngIf="filteredGroupMembers().length === 0"
                  class="h-full flex flex-col items-center justify-center text-center p-8 opacity-40">
                  <p class="text-sm font-bold text-orange-400">Grupo vacío</p>
               </div>
            </div>
         </div>

      </div>
   </main>

   <!-- Success Toast Overlay -->
   <div *ngIf="showSuccess()"
      class="fixed inset-0 z-[100] flex items-center justify-center bg-black/10 backdrop-blur-[2px] animate-fadeIn">
      <div
         class="bg-white rounded-2xl shadow-2xl p-8 flex flex-col items-center gap-4 transform scale-100 animate-bounceIn min-w-[300px]">
         <div
            class="w-16 h-16 rounded-full bg-green-50 border-4 border-green-100 flex items-center justify-center mb-1">
            <svg class="w-8 h-8 text-green-500" viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="3.5">
               <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
         </div>
         <div class="text-center">
            <h3 class="text-xl font-black text-slate-800 tracking-tight">¡Guardado Exitoso!</h3>
            <p class="text-sm text-slate-500 font-medium mt-1">Los cambios han sido aplicados.</p>
         </div>
      </div>
   </div>

   <style>
      @keyframes bounceIn {
         0% {
            opacity: 0;
            transform: scale(0.9);
         }

         50% {
            transform: scale(1.02);
         }

         100% {
            opacity: 1;
            transform: scale(1);
         }
      }

      .animate-bounceIn {
         animation: bounceIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
      }

      .animate-fadeIn {
         animation: fadeIn 0.2s ease-out forwards;
      }

      @keyframes fadeIn {
         from {
            opacity: 0;
         }

         to {
            opacity: 1;
         }
      }
   </style>
</div>